import{jsx as e,Fragment as r,jsxs as t}from"react/jsx-runtime";import{useRef as n,useMemo as s,useCallback as l,useEffect as i,useState as c}from"react";const o=(e,r,t,c={})=>{const o={root:null,rootMargin:"0px",threshold:.1},a=n(null),u=n(new Map),h=s((()=>Object.assign(Object.assign({},o),c)),[c]),d=l(null!=r?r:()=>{},[r]),g=l(null!=t?t:()=>{},[t]);i((()=>(a.current&&a.current.disconnect(),a.current=new IntersectionObserver((e=>{e.forEach((e=>{g(e);const r=u.current.get(e.target),t=e.isIntersecting;r!==t&&(u.current.set(e.target,t),d(t,e))}))}),h),e&&e.forEach((e=>{var r;e&&(null===(r=a.current)||void 0===r||r.observe(e))})),()=>{a.current&&a.current.disconnect()})),[e,h,d,g,u]);return{observe:l((e=>{a.current&&e&&a.current.observe(e)}),[]),unobserve:l((e=>{a.current&&e&&a.current.unobserve(e)}),[])}},a=({item:t,isVisible:s,refreshOnVisible:l,fetchItemData:o,children:a,itemLoader:u})=>{const[h,d]=c(null),g=n(!1);return i((()=>{o&&s&&(l||!g.current)&&o(t).then((e=>{d(e),g.current=!0}))}),[s,l,o,t]),e(r,{children:s?a(t,h):u})},u=({listData:u=[],renderItem:h=(t=>e(r,{children:t||"Loading ..."})),refreshOnVisible:d=!1,fetchItemData:g=null,containerHeight:m="400px",itemStyle:b={},listClassName:v=null,itemClassName:f=null,observerOptions:p={root:null,rootMargin:"0px",threshold:.1},onLoadMore:O=(()=>Promise.resolve()),hasMore:x=!1,loader:M="",endMessage:j="",itemLoader:I="",emptyListMessage:y=null})=>{const[L,w]=c(new Set),[V,D]=c(!1),N=n([]),E=n(null),S=l(((e,r)=>{const t=parseInt(r.target.getAttribute("data-index"),10);w((r=>{const n=new Set(r);return e?n.add(t):n.delete(t),n}))}),[]),C=l((e=>{e&&x&&!V&&(D(!0),O().finally((()=>{D(!1)})))}),[x,O,V]),{observe:A,unobserve:H}=o(N.current,S,null,p);o([E.current],C,null,{root:null,rootMargin:"0px",threshold:1});const P=s((()=>{const e=[...L].sort(((e,r)=>e-r)),r=e[0]||0,t=e[e.length-1]||0;return[Math.max(0,r-1),Math.min(u.length-1,t+1)]}),[L,u.length]);i((()=>{N.current.forEach(((e,r)=>{e&&(r<P[0]||r>P[1])&&(H(e),N.current[r]=null)}))}),[P,H]);const Y=l(((e,r)=>{e?(N.current[r]=e,A(e)):N.current[r]&&(H(N.current[r]),N.current[r]=null)}),[A,H]),k=s((()=>Object.assign({},b)),[b]);return t("div",Object.assign({className:v||void 0,style:{height:m,overflowY:"auto"}},{children:[u.length?u.map(((r,t)=>t>=P[0]&&t<=P[1]?e("div",Object.assign({className:f||void 0,style:k,ref:e=>Y(e,t),"data-index":t},{children:e(a,Object.assign({item:u[t],isVisible:L.has(t),refreshOnVisible:d,fetchItemData:g,itemLoader:I},{children:h}))}),t):null)):y||null,u.length?e("div",x?Object.assign({ref:E,style:{height:"1px"}},{children:M}):{children:j}):null]}))};export{u as default,o as useIntersectionObserver};
