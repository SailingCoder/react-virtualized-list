import{jsx as e,Fragment as t,jsxs as r}from"react/jsx-runtime";import{useRef as n,useMemo as s,useCallback as l,useEffect as i,useState as c}from"react";const o=(e,t,r,c={})=>{const o={root:null,rootMargin:"0px",threshold:.1},a=n(null),u=n(new Map),h=s((()=>Object.assign(Object.assign({},o),c)),[c]),d=l(null!=t?t:()=>{},[t]),g=l(null!=r?r:()=>{},[r]);i((()=>(a.current&&a.current.disconnect(),a.current=new IntersectionObserver((e=>{e.forEach((e=>{g(e);const t=u.current.get(e.target),r=e.isIntersecting;t!==r&&(u.current.set(e.target,r),d(r,e))}))}),h),e&&e.forEach((e=>{var t;e&&(null===(t=a.current)||void 0===t||t.observe(e))})),()=>{a.current&&a.current.disconnect()})),[e,h,d,g,u]);return{observe:l((e=>{a.current&&e&&a.current.observe(e)}),[]),unobserve:l((e=>{a.current&&e&&a.current.unobserve(e)}),[])}},a=({item:r,isVisible:s,refreshOnVisible:l,fetchItemData:o,children:a,itemLoader:u})=>{const[h,d]=c(null),g=n(!1);return i((()=>{o&&s&&(l||!g.current)&&o(r).then((e=>{d(e),g.current=!0}))}),[s,l,o,r]),e(t,{children:s?a(r,h):u})},u=({listData:u=[],renderItem:h=(r=>e(t,{children:r||"Loading data..."})),refreshOnVisible:d=!1,fetchItemData:g=null,containerHeight:m="400px",itemStyle:b={},listClassName:v=null,itemClassName:f=null,observerOptions:p={root:null,rootMargin:"0px",threshold:.1},onLoadMore:O=(()=>Promise.resolve()),hasMore:x=!1,loader:M="",endMessage:j="",itemLoader:I="",emptyListMessage:y=null})=>{const[L,w]=c(new Set),[V,D]=c(!1),N=n([]),E=n(null),S=l(((e,t)=>{const r=parseInt(t.target.getAttribute("data-index"),10);w((t=>{const n=new Set(t);return e?n.add(r):n.delete(r),n}))}),[]),C=l((e=>{e&&x&&!V&&(D(!0),O().finally((()=>{D(!1)})))}),[x,O,V]),{observe:A,unobserve:H}=o(N.current,S,null,p);o([E.current],C,null,{root:null,rootMargin:"0px",threshold:1});const P=s((()=>{const e=[...L].sort(((e,t)=>e-t)),t=e[0]||0,r=e[e.length-1]||0;return[Math.max(0,t-2),Math.min(u.length-1,r+2)]}),[L,u.length]);i((()=>{N.current.forEach(((e,t)=>{e&&(t<P[0]||t>P[1])&&(H(e),N.current[t]=null)}))}),[P,H]);const Y=l(((e,t)=>{e?(N.current[t]=e,A(e)):N.current[t]&&(H(N.current[t]),N.current[t]=null)}),[A,H]),k=s((()=>Object.assign({},b)),[b]);return r("div",Object.assign({className:v||void 0,style:{height:m,overflowY:"auto"}},{children:[u.length?u.map(((t,r)=>r>=P[0]&&r<=P[1]?e("div",Object.assign({className:f||void 0,style:k,ref:e=>Y(e,r),"data-index":r},{children:e(a,Object.assign({item:u[r],isVisible:L.has(r),refreshOnVisible:d,fetchItemData:g,itemLoader:I},{children:h}))}),r):null)):y||null,u.length?e("div",x?Object.assign({ref:E,style:{height:"1px"}},{children:M}):{children:j}):null]}))};export{u as default,o as useIntersectionObserver};
