import e,{useRef as t,useMemo as r,useCallback as n,useEffect as l,useState as a}from"react";const s=function(e,a,s){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c={root:null,rootMargin:"0px",threshold:.1},u=t(null),i=t(new Map),h=r((()=>({...c,...o})),[o]),m=n(a,[a]),d=n(s,[s]);l((()=>(u.current&&u.current.disconnect(),u.current=new IntersectionObserver((e=>{e.forEach((e=>{d&&d(e);const t=i.current.get(e.target),r=e.isIntersecting;t!==r&&(i.current.set(e.target,r),m&&m(r,e))}))}),h),e&&e.forEach((e=>{e&&u.current.observe(e)})),()=>{u.current&&u.current.disconnect()})),[e,m,d,h]);return{observe:n((e=>{u.current&&e&&u.current.observe(e)}),[]),unobserve:n((e=>{u.current&&e&&u.current.unobserve(e)}),[])}},o=r=>{let{item:n,isVisible:s,refreshOnVisible:o,fetchItemData:c,children:u,itemLoader:i}=r;const[h,m]=a(null),d=t(!1);return l((()=>{c&&s&&(o||!d.current)&&c(n).then((e=>{m(e),d.current=!0}))}),[s,o,n]),e.createElement(e.Fragment,null,s?u(n,h):i)},c=c=>{let{listData:u=[],renderItem:i=(t=>e.createElement(e.Fragment,null,t||"Loading data...")),refreshOnVisible:h=!1,fetchItemData:m=null,containerHeight:d="400px",itemStyle:g={},listClassName:f=null,itemClassName:b=null,observerOptions:v={root:null,rootMargin:"0px",threshold:.1},onLoadMore:p=(()=>{}),hasMore:E=!1,loader:M="",endMessage:x="",itemLoader:y="",emptyListMessage:I=null}=c;const[w,L]=a(new Set),[O,V]=a(!1),D=t([]),N=t(null),S=n(((e,t)=>{const r=parseInt(t.target.getAttribute("data-index"),10);L(e?e=>new Set(e).add(r):e=>{const t=new Set(e);return t.delete(r),t})}),[]),{observe:C,unobserve:F}=s(D.current,S,null,v),k=n((e=>{e&&E&&p&&!O&&(V(!0),p().finally((()=>{V(!1)})))}),[E,p,O]);s([N.current],k,null,{root:null,rootMargin:"0px",threshold:1});const A=r((()=>{const e=[...w].sort(((e,t)=>e-t));if(0===e.length)return[0,2];const t=e[0],r=e[e.length-1];return[Math.max(0,t-2),Math.min(u.length-1,r+2)]}),[w,u.length]);l((()=>{D.current.forEach(((e,t)=>{e&&(t<A[0]||t>A[1])&&(F(e),D.current[t]=null)}))}),[A,F]);const H=n(((e,t)=>{e?(D.current[t]=e,C(e)):D.current[t]&&(F(D.current[t]),D.current[t]=null)}),[C,F]),Y=r((()=>({...g})),[g]);return e.createElement("div",{className:f,style:{height:d,overflowY:"auto"}},u.length?u.map(((t,r)=>r>=A[0]&&r<=A[1]?e.createElement("div",{className:b,style:Y,ref:e=>H(e,r),key:r,"data-index":r},e.createElement(o,{item:u[r],isVisible:w.has(r),refreshOnVisible:h,fetchItemData:m,itemLoader:y},i)):null)):I||null,u.length?E?e.createElement("div",{ref:N,style:{height:"1px"}},M):e.createElement("div",null,x):null)};export{c as default,s as useIntersectionObserver};
